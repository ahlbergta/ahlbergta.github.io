<html>
    <head>
        <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
    </head>

    <body>
        <script>
            AFRAME.registerComponent('light-control', {
                init: function () {
                    this.el.addEventListener('click', function (evt) {
                        // Get the main light
                        var light_main = document.querySelector('#light_main');

                        // Rotate the switch
                        this.setAttribute('rotation', {x: -this.getAttribute('rotation').x, y: 0, z: 0});
                        this.emit('on');

                        // Toggle light
                        light_main.setAttribute('visible', !light_main.getAttribute('visible'));
                    });
                }
            });
            AFRAME.registerComponent('fan-control', {
                init: function () {
                    this.el.addEventListener('click', function (evt) {
                        // Get the fan entity
                        var fan = document.querySelector('#fan');

                        // Rotate the switch
                        this.setAttribute('rotation', {x: -this.getAttribute('rotation').x, y: 0, z: 0});
                        this.emit('on');

                        // Toggle animation
                        //fan.setAttribute('rotation', {x: 0, y: 30, z: 0});
                        if (this.getAttribute('rotation').x < 0) {
                            fan.emit('on');
                        }
                        else{
                            fan.emit('off');
                        }
                    });
                }
            });
        </script>

        <!--<script>
            AFRAME.registerComponent('follow', {
                schema: {
                    target: {type: 'selector'},
                    speed: {type: 'number'}
                },
                init: function () {
                    this.directionVec3 = new THREE.Vector3();
                },
                tick: function (time, timeDelta) {
                    var directionVec3 = this.directionVec3;
                    // Grab position vectors (THREE.Vector3) from the entities' three.js objects.
                    var targetPosition = this.data.target.object3D.position;
                    var currentPosition = this.el.object3D.position;
                    // Subtract the vectors to get the direction the entity should head in.
                    directionVec3.copy(targetPosition).sub(currentPosition);
                    // Calculate the distance.
                    var distance = directionVec3.length();
                    // Don't go any closer if a close proximity has been reached.
                    if (distance < 1) { return; }
                    // Scale the direction vector's magnitude down to match the speed.
                    var factor = this.data.speed / distance;
                    ['x', 'y', 'z'].forEach(function (axis) {
                        directionVec3[axis] *= factor * (timeDelta / 1000);
                    });
                    // Translate the entity in the direction towards the target.
                    this.el.setAttribute('position', {
                        x: currentPosition.x + directionVec3.x,
                        y: currentPosition.y + directionVec3.y,
                        z: currentPosition.z + directionVec3.z
                    });
                }
            });
           /*
            AFRAME.registerComponent('moveable', {
                tick: function(){
                    console.log(this.el.);
                }
            })
            */
        </script>-->

        <a-scene>
            <!-- Set up assets -->
            <a-assets>
                <a-asset-item id="static-obj" src="Assets/static.obj"></a-asset-item>
                <a-asset-item id="static-mtl" src="Assets/static.mtl"></a-asset-item>

                <a-asset-item id="transparent-obj" src="Assets/transparent.obj"></a-asset-item>

                <a-asset-item id="fan-obj" src="Assets/fan.obj"></a-asset-item>
                <a-asset-item id="fan-mtl" src="Assets/fan.mtl"></a-asset-item>

                <a-asset-item id="dull-obj" src="Assets/dull.obj"></a-asset-item>
            </a-assets>

            <!-- Set up camera -->
            <a-entity camera="userHeight: 1.6" look-controls wasd-controls mouse-cursor>
                <a-entity cursor="fuse: true; fuseTimeout: 500"
                          position="0 0 -0.1"
                          geometry="primitive: ring; radiusInner: 0.002; radiusOuter: 0.003"
                          material="color: black; shader: flat">
                </a-entity>
            </a-entity>

            <!-- Set up switches -->
            <a-entity id="switch_light" light-control geometry="primitive: box" position="0.953 1.5 -3.23" scale="0.02 0.02 0.5" rotation="-5 0 0" material="color: white"></a-entity>
            <a-entity id="switch_fan" fan-control geometry="primitive: box" position="1.037 1.5 -3.23" scale="0.02 0.02 0.5" rotation="5 0 0" material="color: white"></a-entity>

            <!-- Set up lights -->
            <a-entity obj-model="obj: #transparent-obj" material="color: grey; transparent: true; opacity: 0.7"></a-entity>
            <a-light id="light_main" type="point" color="#f2f2f2" position="0 2.3 0" intensity="2" visible="true"></a-light>
            <a-light id="light_ambient" type="ambient" color="#add8e6" intensity="0.2"></a-light>

            <!-- Set up fan -->
            <a-entity id="fan" obj-model="obj: #fan-obj; mtl: #fan-mtl" rotation="0 0 0" >
                <a-animation attribute="rotation" begin="on" to="0 360 0" dur="1000" easing="linear" repeat="indefinite" end="off"></a-animation>
            </a-entity>

            <!-- Set up static scene -->
            <a-entity obj-model="obj: #static-obj; mtl: #static-mtl"></a-entity>
            <a-entity obj-model="obj: #dull-obj" material="color: #080d0f; roughness: 0.8"></a-entity>
        </a-scene>
    </body>
</html>